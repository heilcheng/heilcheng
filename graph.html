<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hailey's Knowledge Graph</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #fafbfc;
            color: #374151;
            min-height: 100vh;
            overflow: hidden;
        }

        #graph {
            width: 100%;
            height: 100vh;
            background: linear-gradient(135deg, #f8f9fc 0%, #f0f2f8 100%);
        }

        /* Sidebar toggle */
        .sidebar-toggle {
            position: fixed;
            top: 20px;
            left: 20px;
            width: 36px;
            height: 36px;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 100;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
            transition: all 0.2s ease;
        }

        .sidebar-toggle:hover {
            background: #f9fafb;
            border-color: #d1d5db;
        }

        .sidebar-toggle svg {
            width: 16px;
            height: 16px;
            color: #6b7280;
        }

        /* Instructions */
        .instructions {
            position: fixed;
            top: 20px;
            right: 24px;
            font-size: 13px;
            color: #9ca3af;
            z-index: 100;
            font-weight: 400;
        }

        /* Tooltip */
        .tooltip {
            position: absolute;
            padding: 12px 16px;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 10px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.15s ease;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            max-width: 280px;
            z-index: 1000;
        }

        .tooltip.visible {
            opacity: 1;
        }

        .tooltip h3 {
            font-size: 13px;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 4px;
        }

        .tooltip p {
            font-size: 12px;
            color: #6b7280;
            line-height: 1.4;
            margin-bottom: 8px;
        }

        .tooltip .meta {
            display: flex;
            gap: 12px;
            font-size: 11px;
            color: #9ca3af;
        }

        .tooltip .meta span {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        /* Node styles */
        .node-circle {
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .node-circle:hover {
            filter: brightness(0.9);
        }

        .node-label {
            font-family: 'Inter', sans-serif;
            font-size: 11px;
            font-weight: 500;
            fill: #4b5563;
            pointer-events: none;
        }

        .link {
            stroke: #a78bfa;
            stroke-opacity: 0.4;
        }
    </style>
</head>
<body>
    <button class="sidebar-toggle">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 18l6-6-6-6"/>
        </svg>
    </button>

    <div class="instructions">drag to move ¬∑ scroll to zoom</div>

    <div class="tooltip" id="tooltip"></div>

    <svg id="graph"></svg>

    <script>
        // Repository data with REAL star counts from GitHub API
        const repos = [
            // AI/LLMs cluster
            {
                id: "DeepMind",
                name: "DeepMind",
                description: "Record for work at Google DeepMind",
                stars: 472,
                url: "https://github.com/heilcheng/DeepMind",
                topic: "ai",
                cluster: { x: 0.3, y: 0.35 }
            },
            {
                id: "openevals",
                name: "openevals",
                description: "Benchmarking suite for open-weight language models",
                stars: 125,
                url: "https://github.com/heilcheng/openevals",
                topic: "ai",
                cluster: { x: 0.45, y: 0.4 }
            },
            {
                id: "medexplain-evals",
                name: "medexplain-evals",
                description: "A benchmark for audience-adaptive medical explanation quality in LLMs",
                stars: 5,
                url: "https://github.com/heilcheng/medexplain-evals",
                topic: "biomedicine",
                cluster: { x: 0.55, y: 0.55 }
            },
            // Biomedicine cluster
            {
                id: "deepchem-drug-formulation",
                name: "deepchem-drug",
                description: "A computational tutorial for predicting drug formulation properties using DeepChem",
                stars: 4,
                url: "https://github.com/heilcheng/deepchem-drug-formulation",
                topic: "biomedicine",
                cluster: { x: 0.65, y: 0.65 }
            },
            // Web Dev cluster
            {
                id: "truthordare",
                name: "truthordare",
                description: "Âª£Êù±Ë©±ÁúüÂøÉË©±ÁîüÊàêÂô® / Truth or Dare questions generator in Cantonese",
                stars: 8,
                url: "https://github.com/heilcheng/truthordare",
                topic: "webdev",
                cluster: { x: 0.25, y: 0.6 }
            },
            {
                id: "perspective",
                name: "perspective",
                description: "Firefox extension that verifies the accuracy of medical content in YouTube videos",
                stars: 4,
                url: "https://github.com/heilcheng/perspective",
                topic: "webdev",
                cluster: { x: 0.55, y: 0.25 }
            },
            {
                id: "heilcheng.github.io",
                name: "portfolio",
                description: "Personal Website with Obsidian-like knowledge graph",
                stars: 18,
                url: "https://github.com/heilcheng/heilcheng.github.io",
                topic: "webdev",
                cluster: { x: 0.7, y: 0.4 }
            }
        ];

        // Create links based on topics and related content
        const links = [
            // AI connections
            { source: "DeepMind", target: "openevals", strength: 1 },
            { source: "openevals", target: "medexplain-evals", strength: 1 },
            { source: "DeepMind", target: "medexplain-evals", strength: 0.6 },
            
            // Biomedicine connections
            { source: "medexplain-evals", target: "deepchem-drug-formulation", strength: 1 },
            { source: "DeepMind", target: "deepchem-drug-formulation", strength: 0.5 },
            
            // Web dev connections
            { source: "truthordare", target: "heilcheng.github.io", strength: 0.8 },
            { source: "perspective", target: "heilcheng.github.io", strength: 0.8 },
            { source: "truthordare", target: "perspective", strength: 0.5 },
            
            // Cross-topic connections
            { source: "openevals", target: "perspective", strength: 0.4 },
            { source: "deepchem-drug-formulation", target: "openevals", strength: 0.5 }
        ];

        const width = window.innerWidth;
        const height = window.innerHeight;

        const svg = d3.select("#graph")
            .attr("width", width)
            .attr("height", height);

        // Zoom behavior
        const zoom = d3.zoom()
            .scaleExtent([0.3, 3])
            .on("zoom", (event) => {
                g.attr("transform", event.transform);
            });

        svg.call(zoom);

        const g = svg.append("g");

        // Initialize positions based on cluster hints
        repos.forEach(repo => {
            repo.x = repo.cluster.x * width;
            repo.y = repo.cluster.y * height;
        });

        // Force simulation with topic clustering
        const simulation = d3.forceSimulation(repos)
            .force("link", d3.forceLink(links)
                .id(d => d.id)
                .distance(100)
                .strength(d => d.strength * 0.3))
            .force("charge", d3.forceManyBody().strength(-300))
            .force("center", d3.forceCenter(width / 2, height / 2))
            .force("collision", d3.forceCollide().radius(50))
            .force("x", d3.forceX(d => d.cluster.x * width).strength(0.1))
            .force("y", d3.forceY(d => d.cluster.y * height).strength(0.1));

        // Draw links
        const link = g.append("g")
            .selectAll("line")
            .data(links)
            .join("line")
            .attr("class", "link")
            .attr("stroke-width", d => d.strength * 1.5 + 0.5);

        // Node groups
        const node = g.append("g")
            .selectAll("g")
            .data(repos)
            .join("g")
            .attr("class", "node")
            .call(d3.drag()
                .on("start", dragstarted)
                .on("drag", dragged)
                .on("end", dragended));

        // Node circles - size based on stars (log scale for better visualization)
        node.append("circle")
            .attr("class", "node-circle")
            .attr("r", d => Math.log(d.stars + 1) * 5 + 8)
            .attr("fill", d => {
                const colors = {
                    ai: "#8b5cf6",
                    biomedicine: "#a78bfa", 
                    webdev: "#7c3aed"
                };
                return colors[d.topic] || "#8b5cf6";
            })
            .attr("opacity", 0.85)
            .on("click", (event, d) => {
                window.open(d.url, '_blank');
            })
            .on("mouseover", showTooltip)
            .on("mouseout", hideTooltip);

        // Node labels
        node.append("text")
            .attr("class", "node-label")
            .attr("dy", d => Math.log(d.stars + 1) * 5 + 20)
            .attr("text-anchor", "middle")
            .text(d => d.name);

        // Tooltip functions
        const tooltip = document.getElementById('tooltip');

        function showTooltip(event, d) {
            const topicLabels = {
                ai: "AI / LLMs",
                biomedicine: "Biomedicine",
                webdev: "Web Dev"
            };
            tooltip.innerHTML = `
                <h3>${d.id}</h3>
                <p>${d.description}</p>
                <div class="meta">
                    <span>‚≠ê ${d.stars}</span>
                    <span>üìÅ ${topicLabels[d.topic]}</span>
                </div>
            `;
            tooltip.style.left = event.pageX + 15 + 'px';
            tooltip.style.top = event.pageY - 10 + 'px';
            tooltip.classList.add('visible');
        }

        function hideTooltip() {
            tooltip.classList.remove('visible');
        }

        // Update positions
        simulation.on("tick", () => {
            link
                .attr("x1", d => d.source.x)
                .attr("y1", d => d.source.y)
                .attr("x2", d => d.target.x)
                .attr("y2", d => d.target.y);

            node.attr("transform", d => `translate(${d.x},${d.y})`);
        });

        // Drag functions
        function dragstarted(event, d) {
            if (!event.active) simulation.alphaTarget(0.3).restart();
            d.fx = d.x;
            d.fy = d.y;
        }

        function dragged(event, d) {
            d.fx = event.x;
            d.fy = event.y;
        }

        function dragended(event, d) {
            if (!event.active) simulation.alphaTarget(0);
            d.fx = null;
            d.fy = null;
        }

        // Handle resize
        window.addEventListener('resize', () => {
            const newWidth = window.innerWidth;
            const newHeight = window.innerHeight;
            svg.attr("width", newWidth).attr("height", newHeight);
            simulation.force("center", d3.forceCenter(newWidth / 2, newHeight / 2));
            simulation.alpha(0.3).restart();
        });
    </script>
</body>
</html>
